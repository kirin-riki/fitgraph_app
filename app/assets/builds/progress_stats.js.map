{
  "version": 3,
  "sources": ["../../javascript/classes/progress_stats.js", "../../javascript/progress_stats.js"],
  "sourcesContent": ["/* ============ ProgressStats - \u7D71\u8A08\u8868\u66F4\u65B0\u30AF\u30E9\u30B9 ============ */\n\nexport class ProgressStats {\n  constructor(graphViewElement) {\n    this.graphView = graphViewElement;\n  }\n\n  /**\n   * \u7D71\u8A08\u8868\u3092\u66F4\u65B0\n   * @param {string} period - \u671F\u9593 (\"1w\", \"3w\", \"1m\", \"3m\")\n   */\n  update(period) {\n    if (!this.graphView) return;\n\n    const { start, end } = this.#calculatePeriodRange(period);\n    const records = this.#filterRecordsByPeriod(start, end);\n\n    if (records.length === 0) {\n      this.#updateEmptyStats();\n      return;\n    }\n\n    const stats = this.#calculateStats(records);\n    this.#updateDisplay(stats);\n  }\n\n  /**\n   * \u671F\u9593\u7BC4\u56F2\u3092\u8A08\u7B97\n   * @private\n   */\n  #calculatePeriodRange(period) {\n    const now = new Date();\n    const start = new Date(now);\n\n    switch (period) {\n      case \"1w\":\n        start.setTime(now.getTime() - 7 * 86400000);\n        break;\n      case \"3w\":\n        start.setTime(now.getTime() - 21 * 86400000);\n        break;\n      case \"1m\":\n        start.setMonth(now.getMonth() - 1);\n        break;\n      case \"3m\":\n      default:\n        start.setMonth(now.getMonth() - 3);\n        break;\n    }\n\n    return { start, end: now };\n  }\n\n  /**\n   * \u671F\u9593\u5185\u306E\u30EC\u30B3\u30FC\u30C9\u3092\u30D5\u30A3\u30EB\u30BF\n   * @private\n   */\n  #filterRecordsByPeriod(start, end) {\n    const allRecords = JSON.parse(this.graphView.dataset.progressAllRecordsValue) || [];\n\n    return allRecords.filter(r => {\n      const d = new Date(r[0]);\n      return d >= start && d <= end && r[1] != null && r[2] != null;\n    });\n  }\n\n  /**\n   * \u7D71\u8A08\u3092\u8A08\u7B97\n   * @private\n   */\n  #calculateStats(records) {\n    const first = records[0];\n    const last = records[records.length - 1];\n\n    const firstWeight = first ? Number(first[1]) : 0;\n    const lastWeight = last ? Number(last[1]) : 0;\n    const firstFat = first ? Number(first[2]) : 0;\n    const lastFat = last ? Number(last[2]) : 0;\n\n    const firstFatMass = first ? +(firstWeight * firstFat / 100).toFixed(2) : 0;\n    const lastFatMass = last ? +(lastWeight * lastFat / 100).toFixed(2) : 0;\n\n    const { weightToGoal, goalAchieved } = this.#calculateGoalProgress(lastWeight);\n\n    return {\n      firstWeight,\n      lastWeight,\n      firstFat,\n      lastFat,\n      firstFatMass,\n      lastFatMass,\n      weightToGoal,\n      goalAchieved\n    };\n  }\n\n  /**\n   * \u76EE\u6A19\u307E\u3067\u306E\u9032\u6357\u3092\u8A08\u7B97\n   * @private\n   */\n  #calculateGoalProgress(lastWeight) {\n    const targetWeight = JSON.parse(this.graphView.dataset.progressTargetWeightValue);\n\n    if (!targetWeight || lastWeight === 0) {\n      return { weightToGoal: 0, goalAchieved: false };\n    }\n\n    if (lastWeight <= targetWeight) {\n      return { weightToGoal: 0, goalAchieved: true };\n    }\n\n    return {\n      weightToGoal: +(lastWeight - targetWeight).toFixed(2),\n      goalAchieved: false\n    };\n  }\n\n  /**\n   * \u8868\u793A\u3092\u66F4\u65B0\n   * @private\n   */\n  #updateDisplay(stats) {\n    this.#updateWeights(stats.firstWeight, stats.lastWeight);\n    this.#updateFats(stats.firstFat, stats.lastFat);\n    this.#updateFatMasses(stats.firstFatMass, stats.lastFatMass);\n    this.#updateGoalCountdown(stats.weightToGoal, stats.goalAchieved);\n  }\n\n  /**\n   * \u4F53\u91CD\u8868\u793A\u3092\u66F4\u65B0\n   * @private\n   */\n  #updateWeights(first, last) {\n    this.#updateElement('first-weight', first.toFixed(2));\n    this.#updateElement('last-weight', last.toFixed(2));\n  }\n\n  /**\n   * \u4F53\u8102\u80AA\u7387\u8868\u793A\u3092\u66F4\u65B0\n   * @private\n   */\n  #updateFats(first, last) {\n    this.#updateElement('first-fat', first.toFixed(2));\n    this.#updateElement('last-fat', last.toFixed(2));\n  }\n\n  /**\n   * \u8102\u80AA\u91CF\u8868\u793A\u3092\u66F4\u65B0\n   * @private\n   */\n  #updateFatMasses(first, last) {\n    this.#updateElement('first-fat-mass', first.toFixed(2));\n    this.#updateElement('last-fat-mass', last.toFixed(2));\n  }\n\n  /**\n   * \u76EE\u6A19\u30AB\u30A6\u30F3\u30C8\u30C0\u30A6\u30F3\u8868\u793A\u3092\u66F4\u65B0\n   * @private\n   */\n  #updateGoalCountdown(weightToGoal, goalAchieved) {\n    const block = document.getElementById('goal-countdown-block');\n    if (!block) return;\n\n    const targetWeight = JSON.parse(this.graphView.dataset.progressTargetWeightValue);\n\n    if (!targetWeight || weightToGoal === 0 && !goalAchieved) {\n      block.innerHTML = '';\n      return;\n    }\n\n    if (goalAchieved) {\n      block.innerHTML = '<span id=\"goal-achieved-label\" class=\"text-xl font-bold text-violet-600\">\u76EE\u6A19\u9054\u6210\uFF01\uFF01\uFF01</span>';\n    } else {\n      block.innerHTML = `\n        <span id=\"goal-countdown-label\">\u76EE\u6A19\u307E\u3067\u3042\u3068</span>\n        <span id=\"goal-countdown-value\" class=\"text-2xl font-bold text-gray-900 align-middle\" style=\"background: linear-gradient(transparent 60%, #fef08a 60%);\">\n          ${weightToGoal.toFixed(2)}\n        </span>\n        <span id=\"goal-countdown-unit\" class=\"text-base font-bold text-gray-500\">kg</span>\n      `;\n    }\n  }\n\n  /**\n   * \u8981\u7D20\u306E\u30C6\u30AD\u30B9\u30C8\u3092\u66F4\u65B0\n   * @private\n   */\n  #updateElement(id, text) {\n    const el = document.getElementById(id);\n    if (el) el.textContent = text;\n  }\n\n  /**\n   * \u7A7A\u306E\u7D71\u8A08\u3092\u8868\u793A\n   * @private\n   */\n  #updateEmptyStats() {\n    this.#updateDisplay({\n      firstWeight: 0,\n      lastWeight: 0,\n      firstFat: 0,\n      lastFat: 0,\n      firstFatMass: 0,\n      lastFatMass: 0,\n      weightToGoal: 0,\n      goalAchieved: false\n    });\n  }\n}\n", "/* ============ Progress Stats - \u7D71\u8A08\u8868\u66F4\u65B0\u6A5F\u80FD ============ */\n\nimport { ProgressStats } from './classes/progress_stats.js';\n\n// \u30B0\u30ED\u30FC\u30D0\u30EB\u7D71\u8A08\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\nlet progressStatsInstance = null;\n\n/**\n * \u7D71\u8A08\u8868\u3092\u66F4\u65B0\n * @param {string} period - \u671F\u9593 (\"1w\", \"3w\", \"1m\", \"3m\")\n */\nfunction updateStatsTable(period) {\n  const graphView = document.getElementById(\"graph-view\");\n  if (!graphView) return;\n\n  // \u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u304C\u306A\u3051\u308C\u3070\u4F5C\u6210\n  if (!progressStatsInstance) {\n    progressStatsInstance = new ProgressStats(graphView);\n  }\n\n  // \u7D71\u8A08\u3092\u66F4\u65B0\n  progressStatsInstance.update(period);\n}\n\n/**\n * \u671F\u9593\u30BF\u30D6\u5207\u308A\u66FF\u3048\u6642\u306B\u8868\u3082\u66F4\u65B0\n */\nfunction patchPeriodTabEvents() {\n  document.querySelectorAll('.period-tab').forEach(btn => {\n    btn.addEventListener('click', () => {\n      updateStatsTable(btn.dataset.period);\n    });\n  });\n}\n\n// \u30B0\u30ED\u30FC\u30D0\u30EB\u306B\u30A8\u30AF\u30B9\u30DD\u30FC\u30C8\nwindow.updateStatsTable = updateStatsTable;\nwindow.patchPeriodTabEvents = patchPeriodTabEvents;\n"],
  "mappings": "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",
  "names": []
}
